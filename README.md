# ip_notes

为日志文件中的 IP 添加备注信息

例如:

```
$ cat /etc/resolv.conf | ./ip_notes.py -a
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
nameserver 114.114.114.114 [国内 114DNS]

$ last | ./ip_notes.py -a
root  pts/1  10.2.2.2 [小王的电脑]  Mon Jan 15 10:46 - 14:31  (03:44)
root  pts/0  10.2.2.1 [小李的电脑]  Mon Jan 15 10:30 - 13:13  (02:42)

```

通过替换原始 IP 为带备注的 IP，使日志中的IP更容易看懂。

更多使用场景可参考以下公众号链接：

[公众号文章：查 IP 备注的小工具](https://mp.weixin.qq.com/s/HCPcJXS30Sx5GGYKZilesQ)

## 帮助文档

```
$ chmod +x ip_notes.py
$ ./ip_notes.py -h
usage: ip_notes.py [-h] [--ip_file IP_FILE] [--data_file DATA_FILE]
                   [--interactive] [--list] [--erase] [--output_dict]
                   [--output_history] [--search SEARCH]

IP 备注

options:
  -h, --help            show this help message and exit
  --ip_file IP_FILE, -i IP_FILE
                        IP 文件路径，文件内容格式：IP 备注
  --data_file DATA_FILE, -d DATA_FILE
                        数据文件路径，默认数据文件：IP.pkl
  --interactive, -a     读取管道中的内容，并进行IP替换
  --list, -l            显示IP字典中的内容
  --erase, -e           清空数据文件内容
  --output_dict, -od    输出IP字典信息
  --output_history, -oh
                        输出IP历史数据
  --search SEARCH, -s SEARCH
                        在字典中搜索IP

```

首次使用需加载数据文件 


```
$ ./ip_notes.py -i demo_input.txt

$ ./ip_notes.py -l
IP dict:
------------------------------
114.114.114.114: ('国内', '114DNS')
8.8.8.8: ('GoogleDNS',)
4.4.4.4: ('GoogleDNS',)
1.1.1.1: ('CloudflareDNS',)
223.5.5.5: ('阿里云DNS',)
223.6.6.6: ('阿里云DNS',)
219.141.136.10: ('北京电信DNS',)
219.141.140.10: ('北京电信DNS',)
202.103.24.68: ('武汉电信DNS',)
59.51.78.211: ('湖南电信DNS',)
218.2.2.2: ('江苏电信DNS',)
202.101.224.69: ('江西电信DNS',)
120.25.115.20: ('阿里', 'ntp', '时间服务器')

IP history set:
==============================
(empty)

```

数据文件格式

```
$ head demo_input.txt
114.114.114.114 国内 114DNS
8.8.8.8         GoogleDNS
4.4.4.4         GoogleDNS
```

多次加载数据文件并不会覆盖数据，当 IP 备注有更新时，新值会覆盖旧值，旧值会存入历史记录中。

使用 pickle 数据文件存储 IP 数据，文本文件只需要加载一次，后续使用默认数据文件 IP.pkl 加载数据。重置数据文件，使用 -e 选项，或直接删掉数据文件。

交互模式 -a 会从管道中读入文件，如果没有文件输入则等待键盘输入，可用于单次 IP 查询：

```
$ ./ip_notes.py -a
114.114.114.114
114.114.114.114 [国内 114DNS]

```